---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Newsletter from '../../components/Newsletter.astro';
// 1. IMPORTANTE: Importar el componente Image de Astro
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, 
    props: { entry },
  }));
}

const { entry } = Astro.props;
if (!entry) {
  return Astro.redirect('/404');
}
const { Content } = await entry.render();
const { slug } = Astro.params;
const canonicalURL = new URL(`blog/${slug}`, Astro.site); 
const formattedDate = entry.data.pubDate.toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---
<head>
  <link rel="canonical" href={canonicalURL} />
</head>
<Layout title={`${entry.data.title} | De Bits a Bots`} 
  description={entry.data.description}
  image={entry.data.heroImage?.src}}>
  <article class="bg-[#0a1e2b] min-h-screen pb-24 text-white">
    <header class="relative py-24 border-b border-white/10 overflow-hidden">
      <div class="absolute inset-0 opacity-[0.03] pointer-events-none" 
           style="background-image: radial-gradient(#2a99c9 1px, transparent 1px); background-size: 40px 40px;">
      </div>

      <div class="max-w-3xl mx-auto px-6 relative z-10 text-center">
        <div class="flex justify-center gap-2 mb-6">
          {entry.data.tags?.map(tag => (
            <span class="font-['Fira+Code'] text-[#2a99c9] text-[9px] border border-[#2a99c9]/30 px-2 py-1 rounded uppercase tracking-widest">
              {tag}
            </span>
          ))}
        </div>

        <h1 class="font-['Orbitron'] text-3xl md:text-5xl font-black mb-6 leading-tight uppercase text-balance">
          {entry.data.title}
        </h1>
        
        <div class="flex items-center justify-center gap-4 text-slate-400 font-['Inter'] text-sm">
           <time datetime={entry.data.pubDate.toISOString()}>
             {formattedDate}
           </time>
           {entry.data.updatedDate && (
             <span class="text-[10px] text-slate-500 italic">(Actualizado: {entry.data.updatedDate.toLocaleDateString()})</span>
           )}
        </div>
      </div>
    </header>

    {entry.data.heroImage && (
      <div class="max-w-4xl mx-auto px-6 -mt-10 mb-5 relative z-20">
        <Image 
          src={entry.data.heroImage} 
          alt={entry.data.title} 
          width={1200} 
          height={600}
          class="w-full h-[300px] md:h-[500px] object-cover rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border border-white/10"
        />
      </div>
    )}

    <div class="max-w-3xl mx-auto px-6 py-10 prose prose-invert prose-slate lg:prose-xl font-['Inter']">
        <Content />
        <div class="flex items-center gap-4">
          <span class="text-slate-500 text-[10px] font-['Orbitron'] uppercase tracking-widest">Compartir Protocolo:</span>
          
          <a 
            href={`https://www.linkedin.com/shareArticle?mini=true&url=${Astro.url}`} 
            target="_blank" 
            class="p-2 bg-[#0e3146] border border-[#2a99c9]/30 rounded-lg hover:bg-[#2a99c9] hover:text-white transition-all text-[#2a99c9]"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.761 0 5-2.239 5-5v-14c0-2.761-2.239-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
          </a>

          <a 
            href={`https://twitter.com/intent/tweet?url=${Astro.url}&text=${entry.data.title}`} 
            target="_blank" 
            class="p-2 bg-[#0e3146] border border-[#e9691e]/30 rounded-lg hover:bg-[#e9691e] hover:text-white transition-all text-[#e9691e]"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          </a>
        </div>
        <Newsletter tipo="blog" />
    </div>
  </article>
  <div class="mt-16 pt-8 border-t border-white/5 flex flex-col md:flex-row items-center justify-between gap-6">
  <div class="text-slate-400 font-['Fira+Code'] text-xs uppercase tracking-widest">
    // Fin_del_Despliegue
  </div>
  
  
</div>
</Layout>

<style is:global>
  /* Mantenemos tu estética técnica en el contenido */
  .prose h1, .prose h2, .prose h3 {
    font-family: 'Orbitron', sans-serif;
    color: #2a99c9 !important;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-top: 2em !important;
    border-left: 4px solid #e9691e; /* Una pequeña barra naranja lateral */
    padding-left: 15px;
  }
  .prose p {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #cbd5e1; /* Un gris claro, menos cansado que el blanco puro */
    margin-bottom: 1.8em;
  }
  .prose a { color: #e9691e; text-decoration: none; border-bottom: 1px solid transparent; transition: border 0.3s; }
  .prose a:hover { border-bottom-color: #e9691e; }
  .prose code { font-family: 'Fira Code', monospace; background: #0e3146; padding: 0.2em 0.4em; border-radius: 4px; color: #2a99c9 !important; }
</style>
